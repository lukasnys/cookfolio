---
import "@/styles/index.css";

interface Props {
  title: string;
}

const { title } = Astro.props;
const currentPath = Astro.url.pathname;
const base = import.meta.env.BASE_URL;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} — Cookfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter+Tight:ital,wght@0,400;0,500;0,600;1,400&family=Outfit:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    {/* Inline script to set theme before paint — avoids flash */}
    <script is:inline>
      (function () {
        var saved = localStorage.getItem("theme");
        var theme = saved || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", theme);
      })();
    </script>
  </head>
  <body class="min-h-screen">
    <header class="border-b border-border bg-bg-surface/60 backdrop-blur-sm sticky top-0 z-50">
      <nav class="mx-auto flex max-w-3xl items-center justify-between px-6 py-4">
        <a
          href={base}
          class="font-display text-2xl font-semibold text-text hover:text-accent transition-colors"
        >
          Cookfolio
        </a>
        <div class="flex items-center gap-5">
          <div class="flex gap-5 text-sm font-medium">
            <a
              href={base}
              class:list={[
                "transition-colors hover:text-accent",
                currentPath === base || currentPath === base.replace(/\/$/, "")
                  ? "text-accent"
                  : "text-text-muted",
              ]}
            >
              Recipes
            </a>
            <a
              href={`${base}weekly-planner/`}
              class:list={[
                "transition-colors hover:text-accent",
                currentPath.includes("weekly-planner") ? "text-accent" : "text-text-muted",
              ]}
            >
              Weekly Planner
            </a>
          </div>
          <button
            id="theme-toggle"
            type="button"
            class="rounded-lg p-1.5 text-text-muted hover:text-accent hover:bg-bg-elevated transition-colors"
            aria-label="Toggle theme"
          >
            <svg class="sun-icon size-5 hidden" aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
            </svg>
            <svg class="moon-icon size-5 hidden" aria-hidden="true" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
            </svg>
          </button>
        </div>
      </nav>
    </header>

    <main class="mx-auto max-w-3xl px-6 py-10">
      <slot />
    </main>

    <footer class="border-t border-border mt-16">
      <div class="mx-auto max-w-3xl px-6 py-6 text-center text-sm text-text-muted">
        Cookfolio
      </div>
    </footer>

    <script is:inline>
      (function () {
        var toggle = document.getElementById("theme-toggle");
        var sunIcon = toggle.querySelector(".sun-icon");
        var moonIcon = toggle.querySelector(".moon-icon");

        function getEffectiveTheme() {
          var saved = localStorage.getItem("theme");
          if (saved) return saved;
          return window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
        }

        function updateIcons() {
          var theme = getEffectiveTheme();
          // Show sun when dark (click to go light), moon when light (click to go dark)
          sunIcon.style.display = theme === "dark" ? "block" : "none";
          moonIcon.style.display = theme === "light" ? "block" : "none";
        }

        toggle.addEventListener("click", function () {
          var current = getEffectiveTheme();
          var next = current === "dark" ? "light" : "dark";
          document.documentElement.setAttribute("data-theme", next);
          localStorage.setItem("theme", next);
          updateIcons();
        });

        updateIcons();
      })();
    </script>
  </body>
</html>
